# # services:
# #   # Application Next.js Production
# #   app:
# #     build:
# #       context: .
# #       dockerfile: Dockerfile
# #     container_name: crystal_mercerie_container
# #     expose:
# #       - "3000"
# #     env_file:
# #       - .env
# #     environment:
# #       - NODE_ENV=production
# #       - PORT=3000
# #       - HOSTNAME=0.0.0.0
# #     restart: unless-stopped
# #     networks:
# #       - crystal-app-network-prod

# #   # Nginx pour reverse proxy et static files (optionnel mais recommand√©)
# #   nginx:
# #     image: nginx:alpine
# #     container_name: nginx-proxy
# #     ports:
# #       - "80:80"
# #       - "443:443"
# #     volumes:
# #       - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
# #       - /home/vps/images:/usr/share/nginx/html/images
# #       - webroot:/var/www/html
# #       - certbot-etc:/etc/letsencrypt
# #     depends_on:
# #       - app
# #     networks:
# #       - crystal-app-network-prod

# #   certbot:
# #     image: certbot/certbot
# #     container_name: certbot
# #     volumes:
# #       - certbot-etc:/etc/letsencrypt
# #       - certbot-var:/var/lib/letsencrypt
# #       - webroot:/var/www/html
# #     restart: no
# #     networks:
# #       - crystal-app-network-prod
# #     command: certonly --webroot --webroot-path=/var/www/html --email omarichou567@gmail.com --agree-tos --no-eff-email --non-interactive --keep-until-expiring -d crystalmercerie.com

# # networks:
# #   crystal-app-network-prod:
# #     driver: bridge

# # volumes:
# #   webroot:
# #   certbot-etc:
# #   certbot-var:



# version: '3.8'

# services:
#   app:
#     image: ghcr.io/omarichou/ercerie_last-version-coty-c:latest
#     # Supprimez les lignes build: context: et dockerfile:
#     container_name: crystal_mercerie_container
#     ports:
#       - "3000:3000"
#     env_file:
#       - .env
#     environment:
#       - NODE_ENV=production
#       - PORT=3000
#     restart: unless-stopped
#     networks:
#       - crystal-app-network-prod

#   nginx:
#     image: nginx:alpine
#     container_name: nginx-proxy
#     ports:
#       - "80:80"
#       - "443:443"
#     volumes:
#       - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
#       - /home/vps/images:/usr/share/nginx/html/images
#       - webroot:/var/www/html
#       # - certbot-etc:/etc/letsencrypt:ro
#     depends_on:
#       - app
#     networks:
#       - crystal-app-network-prod

#   certbot:
#     image: certbot/certbot
#     container_name: certbot
#     volumes:
#       - certbot-etc:/etc/letsencrypt
#       - certbot-var:/var/lib/letsencrypt
#       - webroot:/var/www/html
#     depends_on:
#       - nginx
#     command: certonly --webroot --webroot-path=/var/www/html --email omarichou567@gmail.com --agree-tos --no-eff-email --non-interactive --keep-until-expiring -d crystalmercerie.com

# networks:
#   crystal-app-network-prod:
#     driver: bridge

# volumes:
#   webroot:
#   certbot-etc:
#   certbot-var:


version: '3.8'

services:
  app:
    image: ghcr.io/omarichou/ercerie_last-version-coty-c:latest
    container_name: crystal_mercerie_container
    ports:
      - "3000:3000"
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - PORT=3000
    restart: unless-stopped
    networks:
      - crystal-app-network-prod

  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - /home/vps/images:/usr/share/nginx/html/images
      - webroot:/var/www/html
      - certbot-etc:/etc/letsencrypt
    depends_on:
      - app
    restart: unless-stopped
    networks:
      - crystal-app-network-prod

  certbot:
    image: certbot/certbot
    container_name: certbot
    volumes:
      - certbot-etc:/etc/letsencrypt
      - certbot-var:/var/lib/letsencrypt
      - webroot:/var/www/html
    depends_on:
      - nginx
    command: certonly --webroot --webroot-path=/var/www/html --email omarichou567@gmail.com --agree-tos --no-eff-email --force-renewal -d crystalmercerie.com -d www.crystalmercerie.com

networks:
  crystal-app-network-prod:
    driver: bridge

volumes:
  webroot:
  certbot-etc:
  certbot-var: